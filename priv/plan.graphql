query TripPlan(
  $origin: PlanLabeledLocationInput!
  $destination: PlanLabeledLocationInput!
  $dateTime: PlanDateTimeInput
  $wheelchair: Boolean
  $modes: PlanModesInput
  $numItineraries: Int
) {
  actualPlan: planConnection(
    origin: $origin,
    destination: $destination,
    dateTime: $dateTime,
    preferences: {
      accessibility: {
        wheelchair: {
          enabled: $wheelchair
        }
      },
      street: {
        walk: {
          reluctance: 5.0
        }
      },
      transit: {
        filters: [
          { exclude: [{ agencies: ["mbta-ma-us-initial:1"] }]}
        ]
      }
    },
    modes: $modes,
    searchWindow: "2h"
    first: $numItineraries
    locale: "en"
  ) { ...PlanInfo }

  idealPlan: planConnection(
    origin: $origin,
    destination: $destination,
    dateTime: $dateTime,
    preferences: {
      accessibility: {
        wheelchair: {
          enabled: $wheelchair
        }
      },
      street: {
        walk: {
          reluctance: 5.0
        }
      },
      transit: {
        filters: [
          { include: [{ agencies: ["mbta-ma-us-initial:1"] }]}
        ]
      }
    },
    modes: $modes,
    searchWindow: "2h"
    first: $numItineraries
    locale: "en"
  ) { ...PlanInfo }
}

fragment PlanInfo on PlanConnection {
  searchDateTime
  routingErrors {
    code
    description
    inputField
  }
  itineraries: edges {
    node {
      accessibilityScore
      duration
      end
      generalizedCost
      legs {
        agency { name }
        distance
        duration
        end { ...TimeInfo }
        from { ...PlaceInfo }
        headsign
        intermediateStops { 
          gtfsId,
          name
        }
        legGeometry { points }
        mode
        realTime
        realtimeState
        route { 
          agency { name }
          gtfsId
          shortName
          longName
          type
          color
          textColor
          desc
          sortOrder
          mode
        }
        start { ...TimeInfo }
        steps {
          distance
          streetName
          absoluteDirection
          relativeDirection
        }
        to { ...PlaceInfo }
        transitLeg
        trip {
          directionId
          gtfsId
          tripHeadsign
          tripShortName
        }
      }
      numberOfTransfers
      start
      walkDistance
    }
  }
}

fragment PlaceInfo on Place {
  name
  lat
  lon
  stop { 
    gtfsId, 
    name
    url
    vehicleMode
    wheelchairBoarding
    zoneId
    parentStation {
      gtfsId
    }
  }
}

fragment TimeInfo on LegTime {
  scheduledTime
  estimated {
    time
    delay
  }
}
